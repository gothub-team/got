var ae=Object.create;var Ir=Object.defineProperty;var ie=Object.getOwnPropertyDescriptor;var ue=Object.getOwnPropertyNames;var fe=Object.getPrototypeOf,pe=Object.prototype.hasOwnProperty;var yt=(t,r)=>()=>(r||t((r={exports:{}}).exports,r),r.exports),se=(t,r)=>{for(var e in r)Ir(t,e,{get:r[e],enumerable:!0})},xt=(t,r,e,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let a of ue(r))!pe.call(t,a)&&a!==e&&Ir(t,a,{get:()=>r[a],enumerable:!(o=ie(r,a))||o.enumerable});return t};var me=(t,r,e)=>(e=t!=null?ae(fe(t)):{},xt(r||!t||!t.__esModule?Ir(e,"default",{value:t,enumerable:!0}):e,t)),ce=t=>xt(Ir({},"__esModule",{value:!0}),t);var _t=yt((Or,vt)=>{(function(t,r){typeof Or=="object"?vt.exports=Or=r():typeof define=="function"&&define.amd?define([],r):t.CryptoJS=r()})(Or,function(){var t=t||function(r,e){var o;if(typeof window<"u"&&window.crypto&&(o=window.crypto),typeof self<"u"&&self.crypto&&(o=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(o=globalThis.crypto),!o&&typeof window<"u"&&window.msCrypto&&(o=window.msCrypto),!o&&typeof global<"u"&&global.crypto&&(o=global.crypto),!o&&typeof require=="function")try{o=require("crypto")}catch{}var a=function(){if(o){if(typeof o.getRandomValues=="function")try{return o.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof o.randomBytes=="function")try{return o.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},i=Object.create||function(){function u(){}return function(p){var l;return u.prototype=p,l=new u,u.prototype=null,l}}(),m={},x=m.lib={},O=x.Base=function(){return{extend:function(u){var p=i(this);return u&&p.mixIn(u),(!p.hasOwnProperty("init")||this.init===p.init)&&(p.init=function(){p.$super.init.apply(this,arguments)}),p.init.prototype=p,p.$super=this,p},create:function(){var u=this.extend();return u.init.apply(u,arguments),u},init:function(){},mixIn:function(u){for(var p in u)u.hasOwnProperty(p)&&(this[p]=u[p]);u.hasOwnProperty("toString")&&(this.toString=u.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),A=x.WordArray=O.extend({init:function(u,p){u=this.words=u||[],p!=e?this.sigBytes=p:this.sigBytes=u.length*4},toString:function(u){return(u||W).stringify(this)},concat:function(u){var p=this.words,l=u.words,d=this.sigBytes,E=u.sigBytes;if(this.clamp(),d%4)for(var v=0;v<E;v++){var G=l[v>>>2]>>>24-v%4*8&255;p[d+v>>>2]|=G<<24-(d+v)%4*8}else for(var b=0;b<E;b+=4)p[d+b>>>2]=l[b>>>2];return this.sigBytes+=E,this},clamp:function(){var u=this.words,p=this.sigBytes;u[p>>>2]&=4294967295<<32-p%4*8,u.length=r.ceil(p/4)},clone:function(){var u=O.clone.call(this);return u.words=this.words.slice(0),u},random:function(u){for(var p=[],l=0;l<u;l+=4)p.push(a());return new A.init(p,u)}}),$=m.enc={},W=$.Hex={stringify:function(u){for(var p=u.words,l=u.sigBytes,d=[],E=0;E<l;E++){var v=p[E>>>2]>>>24-E%4*8&255;d.push((v>>>4).toString(16)),d.push((v&15).toString(16))}return d.join("")},parse:function(u){for(var p=u.length,l=[],d=0;d<p;d+=2)l[d>>>3]|=parseInt(u.substr(d,2),16)<<24-d%8*4;return new A.init(l,p/2)}},L=$.Latin1={stringify:function(u){for(var p=u.words,l=u.sigBytes,d=[],E=0;E<l;E++){var v=p[E>>>2]>>>24-E%4*8&255;d.push(String.fromCharCode(v))}return d.join("")},parse:function(u){for(var p=u.length,l=[],d=0;d<p;d++)l[d>>>2]|=(u.charCodeAt(d)&255)<<24-d%4*8;return new A.init(l,p)}},c=$.Utf8={stringify:function(u){try{return decodeURIComponent(escape(L.stringify(u)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(u){return L.parse(unescape(encodeURIComponent(u)))}},g=x.BufferedBlockAlgorithm=O.extend({reset:function(){this._data=new A.init,this._nDataBytes=0},_append:function(u){typeof u=="string"&&(u=c.parse(u)),this._data.concat(u),this._nDataBytes+=u.sigBytes},_process:function(u){var p,l=this._data,d=l.words,E=l.sigBytes,v=this.blockSize,G=v*4,b=E/G;u?b=r.ceil(b):b=r.max((b|0)-this._minBufferSize,0);var F=b*v,Rr=r.min(F*4,E);if(F){for(var ur=0;ur<F;ur+=v)this._doProcessBlock(d,ur);p=d.splice(0,F),l.sigBytes-=Rr}return new A.init(p,Rr)},clone:function(){var u=O.clone.call(this);return u._data=this._data.clone(),u},_minBufferSize:0}),D=x.Hasher=g.extend({cfg:O.extend(),init:function(u){this.cfg=this.cfg.extend(u),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(u){return this._append(u),this._process(),this},finalize:function(u){u&&this._append(u);var p=this._doFinalize();return p},blockSize:512/32,_createHelper:function(u){return function(p,l){return new u.init(l).finalize(p)}},_createHmacHelper:function(u){return function(p,l){return new z.HMAC.init(u,l).finalize(p)}}}),z=m.algo={};return m}(Math);return t})});var wt=yt((Br,gt)=>{(function(t,r){typeof Br=="object"?gt.exports=Br=r(_t()):typeof define=="function"&&define.amd?define(["./core"],r):r(t.CryptoJS)})(Br,function(t){return function(r){var e=t,o=e.lib,a=o.WordArray,i=o.Hasher,m=e.algo,x=[],O=[];(function(){function W(D){for(var z=r.sqrt(D),u=2;u<=z;u++)if(!(D%u))return!1;return!0}function L(D){return(D-(D|0))*4294967296|0}for(var c=2,g=0;g<64;)W(c)&&(g<8&&(x[g]=L(r.pow(c,1/2))),O[g]=L(r.pow(c,1/3)),g++),c++})();var A=[],$=m.SHA256=i.extend({_doReset:function(){this._hash=new a.init(x.slice(0))},_doProcessBlock:function(W,L){for(var c=this._hash.words,g=c[0],D=c[1],z=c[2],u=c[3],p=c[4],l=c[5],d=c[6],E=c[7],v=0;v<64;v++){if(v<16)A[v]=W[L+v]|0;else{var G=A[v-15],b=(G<<25|G>>>7)^(G<<14|G>>>18)^G>>>3,F=A[v-2],Rr=(F<<15|F>>>17)^(F<<13|F>>>19)^F>>>10;A[v]=b+A[v-7]+Rr+A[v-16]}var ur=p&l^~p&d,te=g&D^g&z^D&z,ee=(g<<30|g>>>2)^(g<<19|g>>>13)^(g<<10|g>>>22),oe=(p<<26|p>>>6)^(p<<21|p>>>11)^(p<<7|p>>>25),ht=E+oe+ur+O[v]+A[v],ne=ee+te;E=d,d=l,l=p,p=u+ht|0,u=z,z=D,D=g,g=ht+ne|0}c[0]=c[0]+g|0,c[1]=c[1]+D|0,c[2]=c[2]+z|0,c[3]=c[3]+u|0,c[4]=c[4]+p|0,c[5]=c[5]+l|0,c[6]=c[6]+d|0,c[7]=c[7]+E|0},_doFinalize:function(){var W=this._data,L=W.words,c=this._nDataBytes*8,g=W.sigBytes*8;return L[g>>>5]|=128<<24-g%32,L[(g+64>>>9<<4)+14]=r.floor(c/4294967296),L[(g+64>>>9<<4)+15]=c,W.sigBytes=L.length*4,this._process(),this._hash},clone:function(){var W=i.clone.call(this);return W._hash=this._hash.clone(),W}});e.SHA256=i._createHelper($),e.HmacSHA256=i._createHmacHelper($)}(Math),t.SHA256})});var wn={};se(wn,{handleHttp:()=>re});module.exports=ce(wn);var At=me(wt(),1),Et=t=>`${(0,At.default)(t)}`,le=process.env.STAGE||"",Cr=process.env.AWS_REGION||"",de={dev:`https://${process.env.API_DOMAIN}/`,local:"http://localhost:4000/dev/"},En=de[le]||`https://${process.env.API_DOMAIN}/`,zr=process.env.BUCKET_LOGS||"",Sn=process.env.BUCKET_EDGES||"",Rn=process.env.BUCKET_REVERSE_EDGES||"",In=process.env.BUCKET_NODES||"",On=process.env.BUCKET_OWNERS||"",Bn=process.env.BUCKET_RIGHTS_ADMIN||"",Cn=process.env.BUCKET_RIGHTS_READ||"",Nn=process.env.BUCKET_RIGHTS_WRITE||"",Tn=process.env.BUCKET_TEST_BEDS||"",Wn=process.env.BUCKET_MEDIA||"",he=process.env.CLOUDFRONT_ACCESS_KEY_ID||"",Gr=process.env.CLOUDFRONT_NEW_ACCESS_KEY_PARAMETER||"",Pn=process.env.INVITE_USER_VALIDATION_VIEW||"",kn=process.env.PULL_LAMBDA_NAME||"",Ln=process.env.NOTIFICATIONS_EMAIL_ACCOUNT_PARAMETER_NAME||"",Dn=process.env.ADMIN_EMAILS||"",bn=process.env.API_DOMAIN||"",ye=process.env.MEDIA_DOMAIN||"",Un=process.env.USER_POOL_ID||"",qn=process.env.CLIENT_ID||"",Mn=process.env.CUSTOM_MAIL_MESSAGE_KEY_ARN||"";var Fn=process.env.CACHE_CONTAINERS||0,Kn=process.env.ENABLE_TRAFFIC_SPLITTING==="false"?!1:process.env.ENABLE_TRAFFIC_SPLITTING||"";var xe=function(){return!0},Jr=xe;function h(t){return t!=null&&typeof t=="object"&&t["@@functional/placeholder"]===!0}function f(t){return function r(e){return arguments.length===0||h(e)?r:t.apply(this,arguments)}}function n(t){return function r(e,o){switch(arguments.length){case 0:return r;case 1:return h(e)?r:f(function(a){return t(e,a)});default:return h(e)&&h(o)?r:h(e)?f(function(a){return t(a,o)}):h(o)?f(function(a){return t(e,a)}):t(e,o)}}}function P(t,r){t=t||[],r=r||[];var e,o=t.length,a=r.length,i=[];for(e=0;e<o;)i[i.length]=t[e],e+=1;for(e=0;e<a;)i[i.length]=r[e],e+=1;return i}function C(t,r){switch(t){case 0:return function(){return r.apply(this,arguments)};case 1:return function(e){return r.apply(this,arguments)};case 2:return function(e,o){return r.apply(this,arguments)};case 3:return function(e,o,a){return r.apply(this,arguments)};case 4:return function(e,o,a,i){return r.apply(this,arguments)};case 5:return function(e,o,a,i,m){return r.apply(this,arguments)};case 6:return function(e,o,a,i,m,x){return r.apply(this,arguments)};case 7:return function(e,o,a,i,m,x,O){return r.apply(this,arguments)};case 8:return function(e,o,a,i,m,x,O,A){return r.apply(this,arguments)};case 9:return function(e,o,a,i,m,x,O,A,$){return r.apply(this,arguments)};case 10:return function(e,o,a,i,m,x,O,A,$,W){return r.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}function J(t,r,e){return function(){for(var o=[],a=0,i=t,m=0;m<r.length||a<arguments.length;){var x;m<r.length&&(!h(r[m])||a>=arguments.length)?x=r[m]:(x=arguments[a],a+=1),o[m]=x,h(x)||(i-=1),m+=1}return i<=0?e.apply(this,o):C(i,J(t,o,e))}}var ve=n(function(r,e){return r===1?f(e):C(r,J(r,[],e))}),S=ve;function s(t){return function r(e,o,a){switch(arguments.length){case 0:return r;case 1:return h(e)?r:n(function(i,m){return t(e,i,m)});case 2:return h(e)&&h(o)?r:h(e)?n(function(i,m){return t(i,o,m)}):h(o)?n(function(i,m){return t(e,i,m)}):f(function(i){return t(e,o,i)});default:return h(e)&&h(o)&&h(a)?r:h(e)&&h(o)?n(function(i,m){return t(i,m,a)}):h(e)&&h(a)?n(function(i,m){return t(i,o,m)}):h(o)&&h(a)?n(function(i,m){return t(e,i,m)}):h(e)?f(function(i){return t(i,o,a)}):h(o)?f(function(i){return t(e,i,a)}):h(a)?f(function(i){return t(e,o,i)}):t(e,o,a)}}}var _e=s(function(r,e,o){var a=o.length;if(r>=a||r<-a)return o;var i=(a+r)%a,m=P(o);return m[i]=e(o[i]),m}),Vr=_e;var R=Array.isArray||function(r){return r!=null&&r.length>=0&&Object.prototype.toString.call(r)==="[object Array]"};function fr(t){return t!=null&&typeof t["@@transducer/step"]=="function"}function _(t,r,e){return function(){if(arguments.length===0)return e();var o=arguments[arguments.length-1];if(!R(o)){for(var a=0;a<t.length;){if(typeof o[t[a]]=="function")return o[t[a]].apply(o,Array.prototype.slice.call(arguments,0,-1));a+=1}if(fr(o)){var i=r.apply(null,Array.prototype.slice.call(arguments,0,-1));return i(o)}}return e.apply(this,arguments)}}function M(t){return t&&t["@@transducer/reduced"]?t:{"@@transducer/value":t,"@@transducer/reduced":!0}}var y={init:function(){return this.xf["@@transducer/init"]()},result:function(t){return this.xf["@@transducer/result"](t)}};function K(t,r){for(var e=0,o=r.length,a=Array(o);e<o;)a[e]=t(r[e]),e+=1;return a}function j(t){return Object.prototype.toString.call(t)==="[object String]"}var ge=f(function(r){return R(r)?!0:!r||typeof r!="object"||j(r)?!1:r.length===0?!0:r.length>0?r.hasOwnProperty(0)&&r.hasOwnProperty(r.length-1):!1}),pr=ge;var we=function(){function t(r){this.f=r}return t.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},t.prototype["@@transducer/result"]=function(r){return r},t.prototype["@@transducer/step"]=function(r,e){return this.f(r,e)},t}();function Nr(t){return new we(t)}var Ae=n(function(r,e){return C(r.length,function(){return r.apply(e,arguments)})}),Yr=Ae;function Ee(t,r,e){for(var o=0,a=e.length;o<a;){if(r=t["@@transducer/step"](r,e[o]),r&&r["@@transducer/reduced"]){r=r["@@transducer/value"];break}o+=1}return t["@@transducer/result"](r)}function St(t,r,e){for(var o=e.next();!o.done;){if(r=t["@@transducer/step"](r,o.value),r&&r["@@transducer/reduced"]){r=r["@@transducer/value"];break}o=e.next()}return t["@@transducer/result"](r)}function Rt(t,r,e,o){return t["@@transducer/result"](e[o](Yr(t["@@transducer/step"],t),r))}var It=typeof Symbol<"u"?Symbol.iterator:"@@iterator";function I(t,r,e){if(typeof t=="function"&&(t=Nr(t)),pr(e))return Ee(t,r,e);if(typeof e["fantasy-land/reduce"]=="function")return Rt(t,r,e,"fantasy-land/reduce");if(e[It]!=null)return St(t,r,e[It]());if(typeof e.next=="function")return St(t,r,e);if(typeof e.reduce=="function")return Rt(t,r,e,"reduce");throw new TypeError("reduce: list must be array or iterable")}var Se=function(){function t(r,e){this.xf=e,this.f=r}return t.prototype["@@transducer/init"]=y.init,t.prototype["@@transducer/result"]=y.result,t.prototype["@@transducer/step"]=function(r,e){return this.xf["@@transducer/step"](r,this.f(e))},t}(),Re=n(function(r,e){return new Se(r,e)}),Ot=Re;function w(t,r){return Object.prototype.hasOwnProperty.call(r,t)}var Bt=Object.prototype.toString,Ie=function(){return Bt.call(arguments)==="[object Arguments]"?function(r){return Bt.call(r)==="[object Arguments]"}:function(r){return w("callee",r)}}(),Tr=Ie;var Oe=!{toString:null}.propertyIsEnumerable("toString"),Ct=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],Nt=function(){"use strict";return arguments.propertyIsEnumerable("length")}(),Be=function(r,e){for(var o=0;o<r.length;){if(r[o]===e)return!0;o+=1}return!1},Ce=typeof Object.keys=="function"&&!Nt?f(function(r){return Object(r)!==r?[]:Object.keys(r)}):f(function(r){if(Object(r)!==r)return[];var e,o,a=[],i=Nt&&Tr(r);for(e in r)w(e,r)&&(!i||e!=="length")&&(a[a.length]=e);if(Oe)for(o=Ct.length-1;o>=0;)e=Ct[o],w(e,r)&&!Be(a,e)&&(a[a.length]=e),o-=1;return a}),B=Ce;var Ne=n(_(["fantasy-land/map","map"],Ot,function(r,e){switch(Object.prototype.toString.call(e)){case"[object Function]":return S(e.length,function(){return r.call(this,e.apply(this,arguments))});case"[object Object]":return I(function(o,a){return o[a]=r(e[a]),o},{},B(e));default:return K(r,e)}})),T=Ne;var V=Number.isInteger||function(r){return r<<0===r};var Te=n(function(r,e){var o=r<0?e.length+r:r;return j(e)?e.charAt(o):e[o]}),Y=Te;var We=n(function(r,e){if(e!=null)return V(r)?Y(r,e):e[r]}),Z=We;var Pe=s(I),U=Pe;var ke=f(function(r){return function(){return r}}),mr=ke;function or(t){var r=Object.prototype.toString.call(t);return r==="[object Function]"||r==="[object AsyncFunction]"||r==="[object GeneratorFunction]"||r==="[object AsyncGeneratorFunction]"}var Me=f(function(r){return r===null?"Null":r===void 0?"Undefined":Object.prototype.toString.call(r).slice(8,-1)}),cr=Me;function tt(t,r){return function(){return r.call(this,t.apply(this,arguments))}}function rr(t,r){return function(){var e=arguments.length;if(e===0)return r();var o=arguments[e-1];return R(o)||typeof o[t]!="function"?r.apply(this,arguments):o[t].apply(o,Array.prototype.slice.call(arguments,0,e-1))}}var je=s(rr("slice",function(r,e,o){return Array.prototype.slice.call(o,r,e)})),k=je;var Xe=f(rr("tail",k(1,1/0))),Pr=Xe;function Q(){if(arguments.length===0)throw new Error("pipe requires at least one argument");return C(arguments[0].length,U(tt,arguments[0],Pr(arguments)))}var He=f(function(r){return j(r)?r.split("").reverse().join(""):Array.prototype.slice.call(r,0).reverse()}),kr=He;function X(){if(arguments.length===0)throw new Error("compose requires at least one argument");return Q.apply(this,kr(arguments))}function Dr(t){for(var r=[],e;!(e=t.next()).done;)r.push(e.value);return r}function tr(t,r,e){for(var o=0,a=e.length;o<a;){if(t(r,e[o]))return!0;o+=1}return!1}function et(t){var r=String(t).match(/^function (\w*)/);return r==null?"":r[1]}function Je(t,r){return t===r?t!==0||1/t===1/r:t!==t&&r!==r}var lr=typeof Object.is=="function"?Object.is:Je;function Lt(t,r,e,o){var a=Dr(t),i=Dr(r);function m(x,O){return dr(x,O,e.slice(),o.slice())}return!tr(function(x,O){return!tr(m,O,x)},i,a)}function dr(t,r,e,o){if(lr(t,r))return!0;var a=cr(t);if(a!==cr(r))return!1;if(typeof t["fantasy-land/equals"]=="function"||typeof r["fantasy-land/equals"]=="function")return typeof t["fantasy-land/equals"]=="function"&&t["fantasy-land/equals"](r)&&typeof r["fantasy-land/equals"]=="function"&&r["fantasy-land/equals"](t);if(typeof t.equals=="function"||typeof r.equals=="function")return typeof t.equals=="function"&&t.equals(r)&&typeof r.equals=="function"&&r.equals(t);switch(a){case"Arguments":case"Array":case"Object":if(typeof t.constructor=="function"&&et(t.constructor)==="Promise")return t===r;break;case"Boolean":case"Number":case"String":if(!(typeof t==typeof r&&lr(t.valueOf(),r.valueOf())))return!1;break;case"Date":if(!lr(t.valueOf(),r.valueOf()))return!1;break;case"Error":return t.name===r.name&&t.message===r.message;case"RegExp":if(!(t.source===r.source&&t.global===r.global&&t.ignoreCase===r.ignoreCase&&t.multiline===r.multiline&&t.sticky===r.sticky&&t.unicode===r.unicode))return!1;break}for(var i=e.length-1;i>=0;){if(e[i]===t)return o[i]===r;i-=1}switch(a){case"Map":return t.size!==r.size?!1:Lt(t.entries(),r.entries(),e.concat([t]),o.concat([r]));case"Set":return t.size!==r.size?!1:Lt(t.values(),r.values(),e.concat([t]),o.concat([r]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var m=B(t);if(m.length!==B(r).length)return!1;var x=e.concat([t]),O=o.concat([r]);for(i=m.length-1;i>=0;){var A=m[i];if(!(w(A,r)&&dr(r[A],t[A],x,O)))return!1;i-=1}return!0}var Ve=n(function(r,e){return dr(r,e,[],[])}),N=Ve;function br(t,r,e){var o,a;if(typeof t.indexOf=="function")switch(typeof r){case"number":if(r===0){for(o=1/r;e<t.length;){if(a=t[e],a===0&&1/a===o)return e;e+=1}return-1}else if(r!==r){for(;e<t.length;){if(a=t[e],typeof a=="number"&&a!==a)return e;e+=1}return-1}return t.indexOf(r,e);case"string":case"boolean":case"function":case"undefined":return t.indexOf(r,e);case"object":if(r===null)return t.indexOf(r,e)}for(;e<t.length;){if(N(t[e],r))return e;e+=1}return-1}function nr(t,r){return br(r,t,0)>=0}function hr(t){var r=t.replace(/\\/g,"\\\\").replace(/[\b]/g,"\\b").replace(/\f/g,"\\f").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\v/g,"\\v").replace(/\0/g,"\\0");return'"'+r.replace(/"/g,'\\"')+'"'}var yr=function(r){return(r<10?"0":"")+r},Ye=typeof Date.prototype.toISOString=="function"?function(r){return r.toISOString()}:function(r){return r.getUTCFullYear()+"-"+yr(r.getUTCMonth()+1)+"-"+yr(r.getUTCDate())+"T"+yr(r.getUTCHours())+":"+yr(r.getUTCMinutes())+":"+yr(r.getUTCSeconds())+"."+(r.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"},Dt=Ye;function Ur(t){return function(){return!t.apply(this,arguments)}}function xr(t,r){for(var e=0,o=r.length,a=[];e<o;)t(r[e])&&(a[a.length]=r[e]),e+=1;return a}function H(t){return Object.prototype.toString.call(t)==="[object Object]"}var Ze=function(){function t(r,e){this.xf=e,this.f=r}return t.prototype["@@transducer/init"]=y.init,t.prototype["@@transducer/result"]=y.result,t.prototype["@@transducer/step"]=function(r,e){return this.f(e)?this.xf["@@transducer/step"](r,e):r},t}(),Qe=n(function(r,e){return new Ze(r,e)}),bt=Qe;var $e=n(_(["fantasy-land/filter","filter"],bt,function(t,r){return H(r)?I(function(e,o){return t(r[o])&&(e[o]=r[o]),e},{},B(r)):xr(t,r)})),qr=$e;var ro=n(function(r,e){return qr(Ur(r),e)}),vr=ro;function _r(t,r){var e=function(m){var x=r.concat([t]);return nr(m,x)?"<Circular>":_r(m,x)},o=function(i,m){return K(function(x){return hr(x)+": "+e(i[x])},m.slice().sort())};switch(Object.prototype.toString.call(t)){case"[object Arguments]":return"(function() { return arguments; }("+K(e,t).join(", ")+"))";case"[object Array]":return"["+K(e,t).concat(o(t,vr(function(i){return/^\d+$/.test(i)},B(t)))).join(", ")+"]";case"[object Boolean]":return typeof t=="object"?"new Boolean("+e(t.valueOf())+")":t.toString();case"[object Date]":return"new Date("+(isNaN(t.valueOf())?e(NaN):hr(Dt(t)))+")";case"[object Null]":return"null";case"[object Number]":return typeof t=="object"?"new Number("+e(t.valueOf())+")":1/t===-1/0?"-0":t.toString(10);case"[object String]":return typeof t=="object"?"new String("+e(t.valueOf())+")":hr(t);case"[object Undefined]":return"undefined";default:if(typeof t.toString=="function"){var a=t.toString();if(a!=="[object Object]")return a}return"{"+o(t,B(t)).join(", ")+"}"}}var to=f(function(r){return _r(r,[])}),gr=to;var eo=f(function(r){return S(r.length,r)}),wr=eo;var no=n(function(r,e){return e==null||e!==e?r:e}),Fr=no;var uo=function(){function t(r,e){this.xf=e,this.n=r,this.i=0}return t.prototype["@@transducer/init"]=y.init,t.prototype["@@transducer/result"]=y.result,t.prototype["@@transducer/step"]=function(r,e){this.i+=1;var o=this.n===0?r:this.xf["@@transducer/step"](r,e);return this.n>=0&&this.i>=this.n?M(o):o},t}(),fo=n(function(r,e){return new uo(r,e)}),Mt=fo;var po=n(_(["take"],Mt,function(r,e){return k(0,r<0?1/0:r,e)})),ar=po;function nt(t){var r=Object.prototype.toString.call(t);return r==="[object Uint8ClampedArray]"||r==="[object Int8Array]"||r==="[object Uint8Array]"||r==="[object Int16Array]"||r==="[object Uint16Array]"||r==="[object Int32Array]"||r==="[object Uint32Array]"||r==="[object Float32Array]"||r==="[object Float64Array]"||r==="[object BigInt64Array]"||r==="[object BigUint64Array]"}var lo=f(function(r){return r!=null&&typeof r["fantasy-land/empty"]=="function"?r["fantasy-land/empty"]():r!=null&&r.constructor!=null&&typeof r.constructor["fantasy-land/empty"]=="function"?r.constructor["fantasy-land/empty"]():r!=null&&typeof r.empty=="function"?r.empty():r!=null&&r.constructor!=null&&typeof r.constructor.empty=="function"?r.constructor.empty():R(r)?[]:j(r)?"":H(r)?{}:Tr(r)?function(){return arguments}():nt(r)?r.constructor.from(""):void 0}),at=lo;var _o=n(function(r,e){return S(r+1,function(){var o=arguments[r];if(o!=null&&or(o[e]))return o[e].apply(o,Array.prototype.slice.call(arguments,0,r));throw new TypeError(gr(o)+' does not have a method named "'+e+'"')})}),ir=_o;var go=n(function(r,e){return e instanceof r||e!=null&&(e.constructor===r||r.name==="Object"&&typeof e=="object")}),Kr=go;var wo=f(function(r){return r!=null&&N(r,at(r))}),ft=wo;var Eo=n(function(r,e){return function(o){return function(a){return T(function(i){return e(i,a)},o(r(a)))}}}),Ar=Eo;var So=s(function(r,e,o){return Vr(r,mr(e),o)}),pt=So;var Ro=f(function(r){return Ar(Y(r),pt(r))}),st=Ro;var Co=s(function(r,e,o){var a={},i;for(i in e)w(i,e)&&(a[i]=w(i,o)?r(i,e[i],o[i]):e[i]);for(i in o)w(i,o)&&!w(i,a)&&(a[i]=o[i]);return a}),jr=Co;var No=s(function t(r,e,o){return jr(function(a,i,m){return H(i)&&H(m)?t(r,i,m):r(a,i,m)},e,o)}),Sr=No;var To=n(function(r,e){return Sr(function(o,a,i){return i},r,e)}),Xr=To;var Mo=s(function(r,e,o){return Fr(r,Z(e,o))}),mt=Mo;var Ho=ir(1,"split"),er=Ho;var Vo=function(){function t(r,e){this.xf=e,this.f=r}return t.prototype["@@transducer/init"]=y.init,t.prototype["@@transducer/result"]=y.result,t.prototype["@@transducer/step"]=function(r,e){return this.f(e),this.xf["@@transducer/step"](r,e)},t}(),Yo=n(function(r,e){return new Vo(r,e)}),Gt=Yo;var Zo=n(_([],Gt,function(r,e){return r(e),e})),ct=Zo;var N1=typeof String.prototype.trim=="function";var tn=function(t){return{value:t,"fantasy-land/map":function(){return this}}},en=n(function(r,e){return r(tn)(e).value}),lt=en;var on=s(function(r,e,o){return r(o)?e(o):o}),dt=on;var _n=require("@aws-sdk/s3-request-presigner"),q=require("@aws-sdk/client-s3");var Vt=()=>new Date().toISOString(),VC=X(ar(10),Vt),YC=X(ar(7),Vt);var ZC=ct(console.log),dn=t=>Buffer.from(t,"base64").toString("utf-8"),QC=Q(er("."),lt(st(1)),dn,JSON.parse),$C=wr((t,r)=>{try{return JSON.parse(r)}catch{return t}});var rN=X(Kr(Function),mt(!1,"then"));var hn={toEdge:t=>Q(er("/"),r=>({fromType:r[0],from:r[1],toType:r[2],to:r[3]}))(t),reverseEdge:t=>({...t,fromType:t.toType,from:t.to,toType:t.fromType,to:t.from}),fromEdge:t=>`${t.from}/${t.fromType}/${t.toType}/${t.to}`,toEdgeTuple:t=>X(([r,e,o,a])=>[e,r,o,a],er("/"))(t),fromEdgeTuple:([t,r,e,o])=>`${r}/${t}/${e}/${o}`,toScope:t=>{let r=t.slice(0,-1).lastIndexOf(".");return r===-1?"":t.substring(0,r+1)},fromNodeIdWildcard:t=>t.slice(-1)!=="*"?"":t.slice(0,-1),toRight:t=>Q(er("/"),r=>({nodeId:r[0],principalType:r[1],principal:r[2]}))(t),fromRight:t=>`${t.nodeId}/${t.principalType}/${t.principal}`,toOwnership:t=>Q(er("/"),r=>({nodeId:r[0],principal:r[2]}))(t),fromOwnership:t=>`${t.nodeId}/user/${t.principal}`,filePrefix:(t,r)=>Et(`${t}/${r}`),toFileKey:({nodeId:t,prop:r,filename:e})=>`file/${hn.filePrefix(t,r)}/${e}`,toFileRefKey:({nodeId:t,prop:r})=>`ref/${t}/${r}`,toFileMetadataKey:({fileKey:t})=>`metadata/${t}`,toLogKey:({type:t,userEmail:r,timestamp:e,requestId:o})=>`${t}/${r}/${e}/${o}`,fromLogKey:X(([t,r,e,o])=>({type:t,userEmail:r,timestamp:e,requestId:o}),er("/"))},tN=U(Xr,{});var eN=dt(ft,Jr);var Hr=require("@aws-sdk/client-ssm");var yn=new Hr.SSMClient({region:Cr,apiVersion:"latest"}),Yt=async(t,r=!1)=>{let e=new Hr.GetParameterCommand({Name:t,WithDecryption:r});try{let o=await yn.send(e);return o.Parameter?o.Parameter.Value:void 0}catch(o){console.log(o);return}};var xn=require("@aws-sdk/cloudfront-signer"),vn=()=>{let t=null;return async()=>(t||(t=Yt(Gr||"CLOUDFRONT_ACCESS_KEY",!0).catch(console.log)),t)},fN=vn();var Zt=new q.S3Client({region:Cr,signatureVersion:"v4",apiVersion:"latest"}),gn=t=>new Promise((r,e)=>{let o=[];t.on("data",a=>o.push(a)),t.on("error",e),t.on("end",()=>r(Buffer.concat(o)))});var Qt=async(t,r)=>{let e=new q.GetObjectCommand({Bucket:t,Key:r});try{let o=await Zt.send(e);return o.Body?gn(o.Body):null}catch{return}};var $t=async(t,r)=>{let e=new q.ListObjectsV2Command({Bucket:t,Prefix:r});try{return(await Zt.send(e)).Contents||[]}catch{return[]}};var re=async t=>validate(completeUploadSchema,t).then(async({body:{id:r,prefix:e=""},userEmail:o})=>{if(r)try{let i=await Qt(zr,`push/${o}/${r}`);return{statusCode:200,headers:CORS_HEADERS,body:JSON.stringify(i)}}catch(i){return console.error(i),{statusCode:404,headers:CORS_HEADERS,body:JSON.stringify({message:"Log not found"})}}let a=await $t(zr,`push/${o}/${e}`).then(({Key:i})=>i.replace(`push/${o}/`,""));return{statusCode:200,headers:CORS_HEADERS,body:JSON.stringify(a)}}).catch(r=>(console.error(r),r));0&&(module.exports={handleHttp});
