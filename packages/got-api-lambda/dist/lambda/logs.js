var Xt=Object.create;var yr=Object.defineProperty;var Kt=Object.getOwnPropertyDescriptor;var Ht=Object.getOwnPropertyNames;var zt=Object.getPrototypeOf,Gt=Object.prototype.hasOwnProperty;var et=(t,r)=>()=>(r||t((r={exports:{}}).exports,r),r.exports),Vt=(t,r)=>{for(var e in r)yr(t,e,{get:r[e],enumerable:!0})},ot=(t,r,e,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let a of Ht(r))!Gt.call(t,a)&&a!==e&&yr(t,a,{get:()=>r[a],enumerable:!(n=Kt(r,a))||n.enumerable});return t};var Jt=(t,r,e)=>(e=t!=null?Xt(zt(t)):{},ot(r||!t||!t.__esModule?yr(e,"default",{value:t,enumerable:!0}):e,t)),Yt=t=>ot(yr({},"__esModule",{value:!0}),t);var Ot=et((Rr,St)=>{(function(t,r){typeof Rr=="object"?St.exports=Rr=r():typeof define=="function"&&define.amd?define([],r):t.CryptoJS=r()})(Rr,function(){var t=t||function(r,e){var n;if(typeof window<"u"&&window.crypto&&(n=window.crypto),typeof self<"u"&&self.crypto&&(n=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(n=globalThis.crypto),!n&&typeof window<"u"&&window.msCrypto&&(n=window.msCrypto),!n&&typeof global<"u"&&global.crypto&&(n=global.crypto),!n&&typeof require=="function")try{n=require("crypto")}catch{}var a=function(){if(n){if(typeof n.getRandomValues=="function")try{return n.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof n.randomBytes=="function")try{return n.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},f=Object.create||function(){function i(){}return function(p){var l;return i.prototype=p,l=new i,i.prototype=null,l}}(),m={},h=m.lib={},w=h.Base=function(){return{extend:function(i){var p=f(this);return i&&p.mixIn(i),(!p.hasOwnProperty("init")||this.init===p.init)&&(p.init=function(){p.$super.init.apply(this,arguments)}),p.init.prototype=p,p.$super=this,p},create:function(){var i=this.extend();return i.init.apply(i,arguments),i},init:function(){},mixIn:function(i){for(var p in i)i.hasOwnProperty(p)&&(this[p]=i[p]);i.hasOwnProperty("toString")&&(this.toString=i.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),A=h.WordArray=w.extend({init:function(i,p){i=this.words=i||[],p!=e?this.sigBytes=p:this.sigBytes=i.length*4},toString:function(i){return(i||T).stringify(this)},concat:function(i){var p=this.words,l=i.words,d=this.sigBytes,I=i.sigBytes;if(this.clamp(),d%4)for(var v=0;v<I;v++){var X=l[v>>>2]>>>24-v%4*8&255;p[d+v>>>2]|=X<<24-(d+v)%4*8}else for(var P=0;P<I;P+=4)p[d+P>>>2]=l[P>>>2];return this.sigBytes+=I,this},clamp:function(){var i=this.words,p=this.sigBytes;i[p>>>2]&=4294967295<<32-p%4*8,i.length=r.ceil(p/4)},clone:function(){var i=w.clone.call(this);return i.words=this.words.slice(0),i},random:function(i){for(var p=[],l=0;l<i;l+=4)p.push(a());return new A.init(p,i)}}),V=m.enc={},T=V.Hex={stringify:function(i){for(var p=i.words,l=i.sigBytes,d=[],I=0;I<l;I++){var v=p[I>>>2]>>>24-I%4*8&255;d.push((v>>>4).toString(16)),d.push((v&15).toString(16))}return d.join("")},parse:function(i){for(var p=i.length,l=[],d=0;d<p;d+=2)l[d>>>3]|=parseInt(i.substr(d,2),16)<<24-d%8*4;return new A.init(l,p/2)}},L=V.Latin1={stringify:function(i){for(var p=i.words,l=i.sigBytes,d=[],I=0;I<l;I++){var v=p[I>>>2]>>>24-I%4*8&255;d.push(String.fromCharCode(v))}return d.join("")},parse:function(i){for(var p=i.length,l=[],d=0;d<p;d++)l[d>>>2]|=(i.charCodeAt(d)&255)<<24-d%4*8;return new A.init(l,p)}},c=V.Utf8={stringify:function(i){try{return decodeURIComponent(escape(L.stringify(i)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(i){return L.parse(unescape(encodeURIComponent(i)))}},g=h.BufferedBlockAlgorithm=w.extend({reset:function(){this._data=new A.init,this._nDataBytes=0},_append:function(i){typeof i=="string"&&(i=c.parse(i)),this._data.concat(i),this._nDataBytes+=i.sigBytes},_process:function(i){var p,l=this._data,d=l.words,I=l.sigBytes,v=this.blockSize,X=v*4,P=I/X;i?P=r.ceil(P):P=r.max((P|0)-this._minBufferSize,0);var U=P*v,hr=r.min(U*4,I);if(U){for(var ir=0;ir<U;ir+=v)this._doProcessBlock(d,ir);p=d.splice(0,U),l.sigBytes-=hr}return new A.init(p,hr)},clone:function(){var i=w.clone.call(this);return i._data=this._data.clone(),i},_minBufferSize:0}),D=h.Hasher=g.extend({cfg:w.extend(),init:function(i){this.cfg=this.cfg.extend(i),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(i){return this._append(i),this._process(),this},finalize:function(i){i&&this._append(i);var p=this._doFinalize();return p},blockSize:512/32,_createHelper:function(i){return function(p,l){return new i.init(l).finalize(p)}},_createHmacHelper:function(i){return function(p,l){return new j.HMAC.init(i,l).finalize(p)}}}),j=m.algo={};return m}(Math);return t})});var Bt=et((Nr,Wt)=>{(function(t,r){typeof Nr=="object"?Wt.exports=Nr=r(Ot()):typeof define=="function"&&define.amd?define(["./core"],r):r(t.CryptoJS)})(Nr,function(t){return function(r){var e=t,n=e.lib,a=n.WordArray,f=n.Hasher,m=e.algo,h=[],w=[];(function(){function T(D){for(var j=r.sqrt(D),i=2;i<=j;i++)if(!(D%i))return!1;return!0}function L(D){return(D-(D|0))*4294967296|0}for(var c=2,g=0;g<64;)T(c)&&(g<8&&(h[g]=L(r.pow(c,1/2))),w[g]=L(r.pow(c,1/3)),g++),c++})();var A=[],V=m.SHA256=f.extend({_doReset:function(){this._hash=new a.init(h.slice(0))},_doProcessBlock:function(T,L){for(var c=this._hash.words,g=c[0],D=c[1],j=c[2],i=c[3],p=c[4],l=c[5],d=c[6],I=c[7],v=0;v<64;v++){if(v<16)A[v]=T[L+v]|0;else{var X=A[v-15],P=(X<<25|X>>>7)^(X<<14|X>>>18)^X>>>3,U=A[v-2],hr=(U<<15|U>>>17)^(U<<13|U>>>19)^U>>>10;A[v]=P+A[v-7]+hr+A[v-16]}var ir=p&l^~p&d,Ut=g&D^g&j^D&j,Ft=(g<<30|g>>>2)^(g<<19|g>>>13)^(g<<10|g>>>22),Mt=(p<<26|p>>>6)^(p<<21|p>>>11)^(p<<7|p>>>25),tt=I+Mt+ir+w[v]+A[v],jt=Ft+Ut;I=d,d=l,l=p,p=i+tt|0,i=j,j=D,D=g,g=tt+jt|0}c[0]=c[0]+g|0,c[1]=c[1]+D|0,c[2]=c[2]+j|0,c[3]=c[3]+i|0,c[4]=c[4]+p|0,c[5]=c[5]+l|0,c[6]=c[6]+d|0,c[7]=c[7]+I|0},_doFinalize:function(){var T=this._data,L=T.words,c=this._nDataBytes*8,g=T.sigBytes*8;return L[g>>>5]|=128<<24-g%32,L[(g+64>>>9<<4)+14]=r.floor(c/4294967296),L[(g+64>>>9<<4)+15]=c,T.sigBytes=L.length*4,this._process(),this._hash},clone:function(){var T=f.clone.call(this);return T._hash=this._hash.clone(),T}});e.SHA256=f._createHelper(V),e.HmacSHA256=f._createHmacHelper(V)}(Math),t.SHA256})});var Do={};Vt(Do,{handler:()=>Lo});module.exports=Yt(Do);function y(t){return t!=null&&typeof t=="object"&&t["@@functional/placeholder"]===!0}function u(t){return function r(e){return arguments.length===0||y(e)?r:t.apply(this,arguments)}}function o(t){return function r(e,n){switch(arguments.length){case 0:return r;case 1:return y(e)?r:u(function(a){return t(e,a)});default:return y(e)&&y(n)?r:y(e)?u(function(a){return t(a,n)}):y(n)?u(function(a){return t(e,a)}):t(e,n)}}}function R(t,r){switch(t){case 0:return function(){return r.apply(this,arguments)};case 1:return function(e){return r.apply(this,arguments)};case 2:return function(e,n){return r.apply(this,arguments)};case 3:return function(e,n,a){return r.apply(this,arguments)};case 4:return function(e,n,a,f){return r.apply(this,arguments)};case 5:return function(e,n,a,f,m){return r.apply(this,arguments)};case 6:return function(e,n,a,f,m,h){return r.apply(this,arguments)};case 7:return function(e,n,a,f,m,h,w){return r.apply(this,arguments)};case 8:return function(e,n,a,f,m,h,w,A){return r.apply(this,arguments)};case 9:return function(e,n,a,f,m,h,w,A,V){return r.apply(this,arguments)};case 10:return function(e,n,a,f,m,h,w,A,V,T){return r.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}function K(t,r,e){return function(){for(var n=[],a=0,f=t,m=0;m<r.length||a<arguments.length;){var h;m<r.length&&(!y(r[m])||a>=arguments.length)?h=r[m]:(h=arguments[a],a+=1),n[m]=h,y(h)||(f-=1),m+=1}return f<=0?e.apply(this,n):R(f,K(t,n,e))}}var Zt=o(function(r,e){return r===1?u(e):R(r,K(r,[],e))}),W=Zt;function s(t){return function r(e,n,a){switch(arguments.length){case 0:return r;case 1:return y(e)?r:o(function(f,m){return t(e,f,m)});case 2:return y(e)&&y(n)?r:y(e)?o(function(f,m){return t(f,n,m)}):y(n)?o(function(f,m){return t(e,f,m)}):u(function(f){return t(e,n,f)});default:return y(e)&&y(n)&&y(a)?r:y(e)&&y(n)?o(function(f,m){return t(f,m,a)}):y(e)&&y(a)?o(function(f,m){return t(f,n,m)}):y(n)&&y(a)?o(function(f,m){return t(e,f,m)}):y(e)?u(function(f){return t(f,n,a)}):y(n)?u(function(f){return t(e,f,a)}):y(a)?u(function(f){return t(e,n,f)}):t(e,n,a)}}}var B=Array.isArray||function(r){return r!=null&&r.length>=0&&Object.prototype.toString.call(r)==="[object Array]"};function ur(t){return t!=null&&typeof t["@@transducer/step"]=="function"}function _(t,r,e){return function(){if(arguments.length===0)return e();var n=arguments[arguments.length-1];if(!B(n)){for(var a=0;a<t.length;){if(typeof n[t[a]]=="function")return n[t[a]].apply(n,Array.prototype.slice.call(arguments,0,-1));a+=1}if(ur(n)){var f=r.apply(null,Array.prototype.slice.call(arguments,0,-1));return f(n)}}return e.apply(this,arguments)}}function q(t){return t&&t["@@transducer/reduced"]?t:{"@@transducer/value":t,"@@transducer/reduced":!0}}var x={init:function(){return this.xf["@@transducer/init"]()},result:function(t){return this.xf["@@transducer/result"](t)}};function rr(t,r){for(var e=0,n=r.length,a=Array(n);e<n;)a[e]=t(r[e]),e+=1;return a}function H(t){return Object.prototype.toString.call(t)==="[object String]"}var Qt=u(function(r){return B(r)?!0:!r||typeof r!="object"||H(r)?!1:r.length===0?!0:r.length>0?r.hasOwnProperty(0)&&r.hasOwnProperty(r.length-1):!1}),or=Qt;var $t=function(){function t(r){this.f=r}return t.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},t.prototype["@@transducer/result"]=function(r){return r},t.prototype["@@transducer/step"]=function(r,e){return this.f(r,e)},t}();function vr(t){return new $t(t)}var re=o(function(r,e){return R(r.length,function(){return r.apply(e,arguments)})}),Lr=re;function te(t,r,e){for(var n=0,a=e.length;n<a;){if(r=t["@@transducer/step"](r,e[n]),r&&r["@@transducer/reduced"]){r=r["@@transducer/value"];break}n+=1}return t["@@transducer/result"](r)}function nt(t,r,e){for(var n=e.next();!n.done;){if(r=t["@@transducer/step"](r,n.value),r&&r["@@transducer/reduced"]){r=r["@@transducer/value"];break}n=e.next()}return t["@@transducer/result"](r)}function at(t,r,e,n){return t["@@transducer/result"](e[n](Lr(t["@@transducer/step"],t),r))}var it=typeof Symbol<"u"?Symbol.iterator:"@@iterator";function S(t,r,e){if(typeof t=="function"&&(t=vr(t)),or(e))return te(t,r,e);if(typeof e["fantasy-land/reduce"]=="function")return at(t,r,e,"fantasy-land/reduce");if(e[it]!=null)return nt(t,r,e[it]());if(typeof e.next=="function")return nt(t,r,e);if(typeof e.reduce=="function")return at(t,r,e,"reduce");throw new TypeError("reduce: list must be array or iterable")}var ee=function(){function t(r,e){this.xf=e,this.f=r}return t.prototype["@@transducer/init"]=x.init,t.prototype["@@transducer/result"]=x.result,t.prototype["@@transducer/step"]=function(r,e){return this.xf["@@transducer/step"](r,this.f(e))},t}(),oe=o(function(r,e){return new ee(r,e)}),ut=oe;function E(t,r){return Object.prototype.hasOwnProperty.call(r,t)}var ft=Object.prototype.toString,ne=function(){return ft.call(arguments)==="[object Arguments]"?function(r){return ft.call(r)==="[object Arguments]"}:function(r){return E("callee",r)}}(),Dr=ne;var ae=!{toString:null}.propertyIsEnumerable("toString"),pt=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],st=function(){"use strict";return arguments.propertyIsEnumerable("length")}(),ie=function(r,e){for(var n=0;n<r.length;){if(r[n]===e)return!0;n+=1}return!1},ue=typeof Object.keys=="function"&&!st?u(function(r){return Object(r)!==r?[]:Object.keys(r)}):u(function(r){if(Object(r)!==r)return[];var e,n,a=[],f=st&&Dr(r);for(e in r)E(e,r)&&(!f||e!=="length")&&(a[a.length]=e);if(ae)for(n=pt.length-1;n>=0;)e=pt[n],E(e,r)&&!ie(a,e)&&(a[a.length]=e),n-=1;return a}),N=ue;var fe=o(_(["fantasy-land/map","map"],ut,function(r,e){switch(Object.prototype.toString.call(e)){case"[object Function]":return W(e.length,function(){return r.call(this,e.apply(this,arguments))});case"[object Object]":return S(function(n,a){return n[a]=r(e[a]),n},{},N(e));default:return rr(r,e)}})),O=fe;var z=Number.isInteger||function(r){return r<<0===r};var pe=o(function(r,e){var n=r<0?e.length+r:r;return H(e)?e.charAt(n):e[n]}),J=pe;var se=s(S),M=se;function gr(t){return function r(e){for(var n,a,f,m=[],h=0,w=e.length;h<w;){if(or(e[h]))for(n=t?r(e[h]):e[h],f=0,a=n.length;f<a;)m[m.length]=n[f],f+=1;else m[m.length]=e[h];h+=1}return m}}var he=u(function(r){return r===null?"Null":r===void 0?"Undefined":Object.prototype.toString.call(r).slice(8,-1)}),pr=he;function Ur(t,r){return function(){return r.call(this,t.apply(this,arguments))}}function Y(t,r){return function(){var e=arguments.length;if(e===0)return r();var n=arguments[e-1];return B(n)||typeof n[t]!="function"?r.apply(this,arguments):n[t].apply(n,Array.prototype.slice.call(arguments,0,e-1))}}var xe=s(Y("slice",function(r,e,n){return Array.prototype.slice.call(n,r,e)})),k=xe;var _e=u(Y("tail",k(1,1/0))),wr=_e;function Ar(){if(arguments.length===0)throw new Error("pipe requires at least one argument");return R(arguments[0].length,M(Ur,arguments[0],wr(arguments)))}var ge=u(function(r){return H(r)?r.split("").reverse().join(""):Array.prototype.slice.call(r,0).reverse()}),Ir=ge;function G(){if(arguments.length===0)throw new Error("compose requires at least one argument");return Ar.apply(this,Ir(arguments))}function sr(t){return t}var we=u(sr),Z=we;function Er(t){for(var r=[],e;!(e=t.next()).done;)r.push(e.value);return r}function Q(t,r,e){for(var n=0,a=e.length;n<a;){if(t(r,e[n]))return!0;n+=1}return!1}function Fr(t){var r=String(t).match(/^function (\w*)/);return r==null?"":r[1]}function Ee(t,r){return t===r?t!==0||1/t===1/r:t!==t&&r!==r}var mr=typeof Object.is=="function"?Object.is:Ee;function ht(t,r,e,n){var a=Er(t),f=Er(r);function m(h,w){return cr(h,w,e.slice(),n.slice())}return!Q(function(h,w){return!Q(m,w,h)},f,a)}function cr(t,r,e,n){if(mr(t,r))return!0;var a=pr(t);if(a!==pr(r))return!1;if(typeof t["fantasy-land/equals"]=="function"||typeof r["fantasy-land/equals"]=="function")return typeof t["fantasy-land/equals"]=="function"&&t["fantasy-land/equals"](r)&&typeof r["fantasy-land/equals"]=="function"&&r["fantasy-land/equals"](t);if(typeof t.equals=="function"||typeof r.equals=="function")return typeof t.equals=="function"&&t.equals(r)&&typeof r.equals=="function"&&r.equals(t);switch(a){case"Arguments":case"Array":case"Object":if(typeof t.constructor=="function"&&Fr(t.constructor)==="Promise")return t===r;break;case"Boolean":case"Number":case"String":if(!(typeof t==typeof r&&mr(t.valueOf(),r.valueOf())))return!1;break;case"Date":if(!mr(t.valueOf(),r.valueOf()))return!1;break;case"Error":return t.name===r.name&&t.message===r.message;case"RegExp":if(!(t.source===r.source&&t.global===r.global&&t.ignoreCase===r.ignoreCase&&t.multiline===r.multiline&&t.sticky===r.sticky&&t.unicode===r.unicode))return!1;break}for(var f=e.length-1;f>=0;){if(e[f]===t)return n[f]===r;f-=1}switch(a){case"Map":return t.size!==r.size?!1:ht(t.entries(),r.entries(),e.concat([t]),n.concat([r]));case"Set":return t.size!==r.size?!1:ht(t.values(),r.values(),e.concat([t]),n.concat([r]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var m=N(t);if(m.length!==N(r).length)return!1;var h=e.concat([t]),w=n.concat([r]);for(f=m.length-1;f>=0;){var A=m[f];if(!(E(A,r)&&cr(r[A],t[A],h,w)))return!1;f-=1}return!0}var Se=o(function(r,e){return cr(r,e,[],[])}),C=Se;var lr=function(r){return(r<10?"0":"")+r},cp=typeof Date.prototype.toISOString=="function"?function(r){return r.toISOString()}:function(r){return r.getUTCFullYear()+"-"+lr(r.getUTCMonth()+1)+"-"+lr(r.getUTCDate())+"T"+lr(r.getUTCHours())+":"+lr(r.getUTCMinutes())+":"+lr(r.getUTCSeconds())+"."+(r.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"};function dr(t,r){for(var e=0,n=r.length,a=[];e<n;)t(r[e])&&(a[a.length]=r[e]),e+=1;return a}function tr(t){return Object.prototype.toString.call(t)==="[object Object]"}var We=function(){function t(r,e){this.xf=e,this.f=r}return t.prototype["@@transducer/init"]=x.init,t.prototype["@@transducer/result"]=x.result,t.prototype["@@transducer/step"]=function(r,e){return this.f(e)?this.xf["@@transducer/step"](r,e):r},t}(),Be=o(function(r,e){return new We(r,e)}),yt=Be;var Re=o(_(["fantasy-land/filter","filter"],yt,function(t,r){return tr(r)?S(function(e,n){return t(r[n])&&(e[n]=r[n]),e},{},N(r)):dr(t,r)})),er=Re;var De=function(){function t(r,e){this.xf=e,this.n=r,this.i=0}return t.prototype["@@transducer/init"]=x.init,t.prototype["@@transducer/result"]=x.result,t.prototype["@@transducer/step"]=function(r,e){this.i+=1;var n=this.n===0?r:this.xf["@@transducer/step"](r,e);return this.n>=0&&this.i>=this.n?q(n):n},t}(),Pe=o(function(r,e){return new De(r,e)}),gt=Pe;var be=o(_(["take"],gt,function(r,e){return k(0,r<0?1/0:r,e)})),Or=be;var Ke=u(gr(!0)),Hr=Ke;var $e=o(function(r,e){return r.map(function(n){for(var a=e,f=0,m;f<n.length;){if(a==null)return;m=n[f],a=z(m)?J(m,a):a[m],f+=1}return a})}),Yr=$e;var ro=o(function(r,e){return Yr([r],e)[0]}),b=ro;var go=o(function(t,r){return C(Or(t.length,r),t)}),Qr=go;var Rw=typeof String.prototype.trim=="function";var Tr=require("@aws-sdk/client-lambda");var Wo=Jt(Bt(),1);var Bo=process.env.STAGE||"",ar=process.env.AWS_REGION||"",Ro={dev:`https://${process.env.API_DOMAIN}/`,local:"http://localhost:4000/dev/"},uR=Ro[Bo]||`https://${process.env.API_DOMAIN}/`,fR=process.env.BUCKET_LOGS||"",pR=process.env.BUCKET_EDGES||"",sR=process.env.BUCKET_REVERSE_EDGES||"",mR=process.env.BUCKET_NODES||"",cR=process.env.BUCKET_OWNERS||"",lR=process.env.BUCKET_RIGHTS_ADMIN||"",dR=process.env.BUCKET_RIGHTS_READ||"",hR=process.env.BUCKET_RIGHTS_WRITE||"",yR=process.env.BUCKET_TEST_BEDS||"",vR=process.env.BUCKET_MEDIA||"",xR=process.env.CLOUDFRONT_ACCESS_KEY_ID||"",_R=process.env.CLOUDFRONT_NEW_ACCESS_KEY_PARAMETER||"",gR=process.env.INVITE_USER_VALIDATION_VIEW||"",wR=process.env.PULL_LAMBDA_NAME||"",AR=process.env.NOTIFICATIONS_EMAIL_ACCOUNT_PARAMETER_NAME||"",IR=process.env.ADMIN_EMAILS||"",ER=process.env.API_DOMAIN||"",SR=process.env.MEDIA_DOMAIN||"",OR=process.env.USER_POOL_ID||"",WR=process.env.CLIENT_ID||"",BR=process.env.CUSTOM_MAIL_MESSAGE_KEY_ARN||"";var Rt=process.env.CACHE_CONTAINERS||0,RR=process.env.ENABLE_TRAFFIC_SPLITTING==="false"?!1:process.env.ENABLE_TRAFFIC_SPLITTING||"";var No=new Tr.LambdaClient({region:ar,apiVersion:"latest"}),Nt=new TextDecoder,Tt=async(t,r)=>{let e=new Tr.InvokeCommand({FunctionName:t,Payload:JSON.stringify({body:r}),InvocationType:"RequestResponse"});try{let n=await No.send(e);return n.FunctionError?Promise.reject(JSON.parse(Nt.decode(n.Payload))):JSON.parse(Nt.decode(n.Payload))}catch(n){console.log(n);return}};var kr=require("@aws-sdk/client-ec2");var To=new kr.EC2Client({region:ar,signatureVersion:"v4",apiVersion:"latest"}),kt=async t=>{let r=new kr.DescribeInstancesCommand({InstanceIds:t});try{let{Reservations:e=[]}=await To.send(r);return G(Hr,O(b(["Instances"])))(e)}catch(e){return console.log(e),[]}};var $=require("@aws-sdk/client-ecs");var $r=new $.ECSClient({region:ar,signatureVersion:"v4",apiVersion:"latest"}),Ct=async(t,r)=>{let e=new $.ListTasksCommand({cluster:t,serviceName:r,desiredStatus:"RUNNING"});try{let{taskArns:n=[]}=await $r.send(e);return n}catch(n){return console.log(n),[]}},Lt=async(t,r)=>{let e=new $.DescribeTasksCommand({cluster:t,tasks:r});try{let{tasks:n=[]}=await $r.send(e);return n}catch(n){return console.log(n),[]}},Dt=async(t,r)=>{let e=new $.DescribeContainerInstancesCommand({cluster:t,containerInstances:r});try{let{containerInstances:n=[]}=await $r.send(e);return n}catch(n){return console.log(n),[]}};var rt="cache-cluster",ko="got-api-server",Co=async()=>{try{let t=await Ct(rt,ko);if(t.length===0)return[];let r=await Lt(rt,t),e=G(er(Z),O(b(["containerInstanceArn"])))(r);if(e.length===0)return[];let n=await Dt(rt,e),a=G(er(Z),O(b(["ec2InstanceId"])))(n);if(a.length===0)return[];let f=await kt(a);return G(er(Z),O(b(["PrivateDnsName"])))(f)}catch{return[]}},Cr={},Pt=0,bt=async()=>Rt<=0?[]:(Cr.current&&Date.now()<=Pt+1e3*60*5||(Cr.current=Co(),Pt=Date.now()),Cr.current);var qt=async t=>{let r=await bt();await Promise.all(O(e=>Tt("got-api-dev-invokeGotCache",{url:`http://${e}/dev/handle-log`,payload:{key:t}}).catch(n=>(console.log("error updating cache of",e,n.message||n),null)))(r)),console.log(`Updated ${r.length} instances`)};var Lo=async t=>{try{let r=t.Records.map(async e=>{let{key:n}=e.s3.object,a=decodeURIComponent(n.replace(/\+/g,"%20"));console.log(`Handle log of ${a}`),Qr("push/",a)&&await qt(a)});await Promise.all(r).catch(console.log)}catch(r){console.log(r)}};0&&(module.exports={handler});
